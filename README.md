# ProyectoOmega Turbo Message
## Introducción
Turbo Message es un servicio de mensajería instantánea desarrollado sobre Java. Esta aplicación utiliza un sistema de colas montadas en ActiveMQ de Apache para poder ofrecer el servicio de mensajería a “n” usuarios concurrentemente. El servicio consiste en que cada usuario pueda tener un directorio persistente de múltiples otros usuarios a los cuales pueda contactar por medio de mensajes. Estos mensajes se distribuyen a los usuarios, estén o no conectados, y se le notifica al emisor una vez que su mensaje es leído o recibido por el usuario receptor. En caso de que se esté contactando por primera vez a un usuario, se lleva a cabo un proceso de solicitud de amistad donde el usuario A manda una solicitud de amistad al usuario B el cual puede decidir si quiere aceptar o no la solicitud. En caso de que se acepte, ambos contactos podrán establecer una comunicación. En el caso contrario, se le notifica al usuario A que su solicitud fue denegada y no podrá establecer una comunicación con el usuario B.

## Descripción de la arquitectura
Nuestra arquitectura parte de objetos tipo “Usuario”. Estos objetos son guardados en un diccionario llamado “directorioTotal” donde se maneja una lista persistente de todos los usuarios registrados en Turbo Message. Ahora, cada objeto “Usuario” cuenta con atributos propios entre los que se encuentra su nombre, un directorio personal de sus contactos, una clave privada para poder mandarle mensajes y una clave pública para poder mandarle solicitudes de amistad.
                                                                                                      
Cuando un usuario se registra o inicia sesión en la aplicación se debe de crear un objeto tipo Usuario, o bien se recupera el objeto ya existente de la lista directorioTotal. Después, se arrancan 4 procesos, o hilos, para cada usuario, que son ChatReceiver, ChatSender, RequestReceiver y RequestSender. Estas cuatro clases estarán interactuando con las colas de ActiveMQ para poder dar el servicio. La comunicación parte de enviar y recibir objetos tipo Mensaje, donde se incluye la carga útil del mensaje, el emisor del mensaje y el tipo de mensaje que se envía (ya sea solicitud, respuesta de solicitud o mensaje para una conversación). Estas clases que mencionamos, y que se muestran en la figura 1, tienen la siguiente funcionalidad:

### RequestSender: 
Esta clase se instancia con la referencia del usuario que inició sesión desde la sección de envío de solicitudes de la interfaz gráfica personal del usuario. Después de instanciarse, inicializa la conexión con Active MQ para poder enviar solicitudes a los usuarios que se desee (previamente registrados en la aplicación). El usuario entonces puede teclear el nombre de algún otro usuario que desee agregar a su lista de contactos y al dar click en el botón correspondiente, se envía un mensaje de tipo solicitud al usuario deseado.

### RequestReceiver: 
Esta clase se instancia pasándole la referencia del usuario que inició sesión, así como de la sección de recepción y envío de mensajes de su interfaz gráfica personal. Así, el hilo estará “escuchando” constantemente la cola pública del usuario, mediante un ciclo while, para poder recibir las solicitudes de amistad de otros usuarios. Una vez que recibe una solicitud inmediatamente se despliega una ventana de opción (pop-up), en la que se muestra el mensaje de la solicitud de amistad. Entonces, el usuario decidirá si acepta o no la solicitud, y enviará su respuesta a la cola pública del solicitante.
Esta clase también recibe las respuestas de las solicitudes de amistad, por lo que cuando se contesta la solicitud, se muestra en el textbox de recepción de mensajes la respuesta. Si se acepta la solicitud, inmediatamente se actualiza el dropdown-list de los contactos del usuario, donde podrá elegir al nuevo contacto para establecer una conversación con él.

### ChatReceiver:
Similar a la clase RequestReceiver, esta clase se inicializa con la referencia del usuario y de la sección de recepción y envío de mensajes de la interfaz gráfica personal del usuario. En general la estructura de la clase es muy similar que RequestReceiver, con la diferencia de que esta clase “escucha” a la cola privada del usuario. De esta forma, cuando se recibe un mensaje de algún contacto, se despliega en el textbox de recepción de mensajes el mensaje recibido, así como el contacto que lo envió.
Al mismo tiempo, al recibir el mensaje se envía al contacto emisor un mensaje de tipo “confirmación de recepción”, que al recibirse despliega en la ventana del emisor la confirmación de recepción del mensaje que envió en un primer lugar.

### ChatSender:
Esta clase se utiliza para controlar el envío de mensajes a los usuarios previamente agregados a la lista de contactos del usuario. Se inicializa con la referencia del usuario y de la sección de recepción y envío de mensajes de la interfaz gráfica personal. Entonces, el usuario escribe un mensaje en el textbox de redacción de mensajes y selecciona del dropdown-list el contacto a quien desea enviar el mensaje. Así, al dar click en el botón de envió, se realiza la conexión en ActiveMQ a la cola privada del contacto elegido y se envía el mensaje.
Cuando el usuario cierra su sesión en la aplicación, se finaliza la ejecución de estos hilos enviando un mensaje a sí mismo con texto “Good bye!”, que sirve como una bandera de fin para el ciclo while. Entonces finaliza la ejecución de los hilos y se cierran las conexiones de ActiveMQ.
